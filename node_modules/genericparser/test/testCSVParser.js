var GenericParser = require("../index.js");
var fs = require("fs");

describe("Csv parser",function(){
    it ("Should test OSM_MTP_Pharmacie.csv file",function(done){
         var stream = fs.createWriteStream(__dirname+"/files/output/OSM_MTP_Pharmacie.json");
        GenericParser("csv").parse(__dirname + "/files/input/OSM_MTP_Pharmacie.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]");
                done()
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
     it ("Should test OSM_MTP_Recyclage.csv file",function(done){
        var stream = fs.createWriteStream(__dirname+"/files/output/OSM_MTP_Recyclage.json");
        GenericParser("csv").parse(__dirname + "/files/input/OSM_MTP_Recyclage.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
    it ("Should test OSM_MTP_Restaurants.csv csv file",function(done){
         var stream = fs.createWriteStream(__dirname+"/files/output/OSM_MTP_Restaurants.json");
        GenericParser("csv").parse(__dirname + "/files/input/OSM_MTP_Restaurants.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
    it ("Should test OSM_MTP_StationService.csv file",function(done){
        var stream = fs.createWriteStream(__dirname+"/files/output/OSM_MTP_StationService.json");
        GenericParser("csv").parse(__dirname + "/files/input/OSM_MTP_StationService.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
    
    
    it ("Should test OSM_MTP_TelephonePublic.csv file",function(done){
         var stream = fs.createWriteStream(__dirname+"/files/output/OSM_MTP_TelephonePublic.json");
        GenericParser("csv").parse(__dirname + "/files/input/OSM_MTP_TelephonePublic.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
     it ("Should test VilleMTP_MTP_Elections_2012.csv file",function(done){
         var stream = fs.createWriteStream(__dirname+"/files/output/VilleMTP_MTP_Elections_2012.json");
        GenericParser("csv").parse(__dirname + "/files/input/VilleMTP_MTP_Elections_2012.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
    it ("Should test VilleMTP_MTP_EtabliPublic_2011.csv file",function(done){
           var stream = fs.createWriteStream(__dirname+"/files/output/VilleMTP_MTP_EtabliPublic_2011.json");
        GenericParser("csv").parse(__dirname + "/files/input/VilleMTP_MTP_EtabliPublic_2011_v3.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
    it ("Should test VilleMTP_MTP_FontainesPublic.csv file",function(done){
         var stream = fs.createWriteStream(__dirname+"/files/output/VilleMTP_MTP_FontainesPublic.json");
        GenericParser("csv").parse(__dirname + "/files/input/VilleMTP_MTP_FontainesPublic.csv", function(result, index) {
            if (index == 1)
                stream.write("[");
            else if (result == null) {
                stream.write("]"); 
                done();
                return;
            }
            else
                stream.write(",");
            stream.write(JSON.stringify(result));
        });
    });
});



