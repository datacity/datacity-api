# Generic Parser

## Installation

    npm install genericParser
    
## Utilisation

Le module genericParser permet de parser différents types d'outputs en diférents type d'output.

Les différents types d'input et d'output sont :

* un stream 
* un path
* une string

Dans sa version béta le module genericParser permet de parser des input de type : 

* CSV
* JSON
* XML
* XLS

## Fonctionement

Le constructeur de GenericParser prend en paramètre le type de l'input. Cela aura pour effet d'instancier le parseur correspondant. Le module genericParser implémente les méthodes from() et to(). La sortie de l'output est par contre imposée et sera en format json.

```javascript
var genericParser = new GenericParser("csv");
genericParser
    .from(fs.createReadStream("./testInput.csv"))
    .to(fs.createWriteStream("./testOutput.json"));
```

## Evènements

Il est également possible de récupérer le contenu ligne par ligne ou entier depuis l'input sans utiliser la méthode to. Dans ce cas, il vous suffit simplement d'écouter l'évènement :

* "record_parsed" : Appellé a chaques lignes.
* "end_parsed" : Appellé à la fin du parsing.

exemple : 

```javascript
var genericParser = new GenericParser("csv");
genericParser
    .from(fs.createReadStream("./testInput.csv"));
    
genericParser.on("record_parsed", function(resultRow,rawRow,rowIndex) {});
genericParser.on("end_parsed", function() {});
```

Notez que si vous utilisez ces évenements vous n'aurez que les lignes parsées avec un résultat qui ressemblera à ceci :

```json
{"itemName": "item1", "number": 10}
{"itemName": "item2", "number": 4}
```

##### Gestion d'erreur


Dans le cas où une erreur survient dans le parseur, un évènement "error"  est envoyé. Pour le récuperer, il suffit d'écouter l'évènement comme ceci :

```javascript
genericParser.on("error", function(errType, errMessage) {})
```



## Sortie


```json
{
    "csvRows":[
        {
            "itemName":"item1",
            "number":10
        },
        {
            "itemName":"item2",
            "number":4
        }
    ]
}
```

## Test 

Pour vérifier le fonctionnement du parseur, il suffit d'installer mocha en faisant :
    
    npm install -g mocha
    npm install -g spec
    
Pour lancer les tests, faire: 

    mocha nomdutest -R spec --require should
    
Les tests sont situés dans le répertoire :
    
    /test

Exemple de test : 

```bash
Csv parser:     
    ✓ Should read from an input file, parse it and write in output file 
  1 passing (2ms)
```
