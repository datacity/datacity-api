# Generic Parser

## Installation

    npm install genericParser
    
## Utilisation

Le module genericParser permet de transformer différents types d'entrée en format json.

Les différents types d'entrées sont :

* un flux
* un chemin
* une string

Dans sa version béta le module genericParser permet de parser des entrées de type: 

* CSV
* JSON
* XML
* XLS

## Fonctionement

Dans votre projet node.js il vous suffit de charger le module de la façon suivante: 

```javascript
var genericParser = require('genericparser');    
```


Le constructeur de GenericParser prend en paramètre le type de l'input. Cela aura pour effet d'instancier le parseur correspondant. Le module genericParser implémente la méthode parse. La sortie est pour le moment en format json.
Voici comment faire l'instanciation du module : 

```javascript
var genericParser = new GenericParser("csv"); //TYPE DE PARSEUR
genericParser.parse("path.csv", false, function(result, index) {}); 
```
 * Premier paramètre: path vers le fichier correspondant
 * Deuxième paramètre: true pour avoir le résultat ligne par ligne et false pour avoir le resultat en un bloc
 * Troisième paramètre: une fonction qui contient le resultat et l'index correspondant à une ligne dans le cas où le paramètre précédent est à false



## Evènements

Il est également possible de récupérer le contenu par des évènement. Dans ce cas, il vous suffit simplement d'écouter l'évènement :

* "record_parsed" : Appellé a chaques lignes.
* "end_parsed" : Appellé à la fin du parsing.

exemple : 

```javascript
var genericParser = new GenericParser("csv");

genericParser.on("record_parsed", function(resultRow,rawRow,rowIndex) {});
genericParser.on("end_parsed", function() {});
genericParser.parse("./testInput.csv");
```

Notez que si vous utilisez ces évenements vous aurez un résultat qui ressemblera à ceci :

```json
{"champ1": "item1", "champ2": 10} 
{"champ1": "item2", "champ2": 4}
```

##### Gestion d'erreur


Dans le cas où une erreur survient dans le parseur, un évènement "error"  est envoyé. Pour le récuperer, il suffit d'écouter l'évènement comme ceci :

```javascript
genericParser.on("error", function(errType, errMessage) {})
```



## Sortie


```json
{
    "results":[
        {
            "itemName":"item1",
            "number":10
        },
        {
            "itemName":"item2",
            "number":4
        }
    ]
}
```
## Tests

pour le lancement des tests unitaires, nous utilisons le module [mocha](https://github.com/visionmedia/mocha ""). Il suffit de faire la manipulation suivante:  
    
    cd test
    node mochaLauncher.js
    
Exemple de sortie : 

```diff
Csv parser
    ✓ Should test OSM_MTP_Pharmacie.csv file (74ms)
    ✓ Should test OSM_MTP_Recyclage.csv file (51ms)
    ✓ Should test OSM_MTP_Restaurants.csv csv file (419ms)
    ✓ Should test OSM_MTP_TelephonePublic.csv file (42ms)
    ✓ Should test VilleMTP_MTP_EtabliPublic_2011.csv file (1142ms)
    ✓ Should test VilleMTP_MTP_FontainesPublic.csv file (59ms)

  JSON parser
    ✓ Should test .json file (113ms)

  XML parser
    ✓ Should test .xml file 
```
    
## Informations complémentaires

Pour une description détaillée du module et des fonctions, nous vous invitons a aller voir la documentation du module. Pour se faire rendez vous sur [notre site](http://documentation.api.datacity.fr "").

Enfin, si vous désirez vous-même générer la documentation, vous devrez installer [jsdoc](https://github.com/jsdoc3/jsdoc "") ainsi que [docstrap](https://github.com/terryweiss/docstrap "") et faire la manipulation suivante dans le répertoire courant de genericParser

    sudo jsdoc ./lib/* README.md -t /usr/lib/node_modules/ink-docstrap/template/ -c /usr/lib/node_modules/ink-docstrap/template/jsdoc.conf.json -d ./out/
