var fs = require('fs');
var xml2js = require('xml2js');
var jsonParser = require('./parserJSON.js');


var parseXML = function(fileName, noRam, callback) {
    var XMLparser = new xml2js.Parser({explicitArray: false});
    fs.readFile(fileName, function(err, data) {
    	XMLparser.parseString(data, function (err, result) {
			var first;
			for (var property in result) {
			    if (result.hasOwnProperty(property)) {
			        first = result[property];
			        break;
			    }
			}

    		var str = JSON.stringify(first);
    		var parser = new jsonParser();
    		parser.parseString(str, noRam, callback);
        });
    });
};

function parserXML() {
    this.parse = parseXML;
    return this;
}

module.exports = parserXML;